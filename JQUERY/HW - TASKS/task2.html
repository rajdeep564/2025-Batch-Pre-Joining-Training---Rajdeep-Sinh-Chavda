<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bootstrap Template</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        .signature-pad {
            border: 1px solid #ddd;
            border-radius: 5px;
            height: 100px;
            width: 300px;
        }
    </style>
</head>

<body class="bg-white">
    <div class="container col-8 bg-light p-5 border rounded mt-5 mb-5">

        <div class="mt-2">
            <h3 class="text-center">Certificate of Foreign Status of Beneficial Owner for United States Tax Withholding
                and Reporting (Individuals)</h3>
            <p class="text-center fs-5">Department of the Treasury Internal Revenue Service</p>
        </div>
        <hr>

        <p>For use by individuals. Entities must use Form W-8BEN-E.</p>
        <p>Go to www.irs.gov/FormW8BEN for instructions and the latest information.</p>
        <p>Give this form to the withholding agent or payer. Do not send to the IRS.</p>

        <div class="mt-5">
            <b>Do NOT use this form if:</b>
            <ul>
                <li>You are NOT an individual</li>
                <li>You are a U.S. citizen or other U.S. person, including resident alien individual</li>
                <li>You are a beneficial owner claiming that income is effectively connected with the conduct of trade
                    or business with the U.S. (other than personal services)</li>
                <li>You are a beneficial owner who is receiving compensation for personal services performed in the
                    United States</li>
                <li>You are a person acting as an intermediary</li>
            </ul>
        </div>

        <hr class="mt-5">

        <p><b>Note:</b> If you are resident in a FATCA partner jurisdiction (i.e., a Model 1 IGA jurisdiction with
            reciprocity), certain tax account information may be provided to your jurisdiction of residence.</p>

        <div class="mt-5">
            <h4>Part I: Identification of Beneficial Owner</h4>
            <small>See instructions</small>
        </div>

        <hr>

        <form id="certificateForm" class="needs-validation" novalidate>
            <div class="my-3 row">
                <div class="col-4">
                    <label for="beneficialOwnerName">1. Name of individual who is the beneficial owner</label>
                </div>

                <div class="col-8">
                    <input type="text" class="form-control" id="beneficialOwnerName" name="beneficialOwnerName"
                        required>
                    <small class="text-danger" id="beneficialOwnerNameError"></small>
                </div>
            </div>

            <div class="my-3 row">
                <div class="col-4">
                    <label for="countryOfCitizenship">2. Country of citizenship</label>
                </div>

                <div class="col-8">
                    <input type="text" class="form-control" id="countryOfCitizenship" name="countryOfCitizenship"
                        required>
                    <small class="text-danger" id="countryOfCitizenshipError"></small>
                </div>
            </div>

            <div class="my-3 row">
                <div class="col-4">
                    <label for="permanentAddress">3. Permanent residence address street, apt. or suite no., or rural
                        route. Do not use a P.O. box or in-care-of address.</label>
                </div>

                <div class="col-8">
                    <div>
                        <input type="text" class="form-control" id="permanentAddress" name="permanentAddress" required>
                        <small>Street Address</small>
                        <small class="text-danger" id="permanentAddressError"></small>
                    </div>

                    <div class="mt-3">
                        <input type="text" class="form-control" id="permanentAddress2" name="permanentAddress2">
                        <small>Street Address Line2</small>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="city" name="city" required>
                            <small>City</small>
                            <small class="text-danger" id="cityError"></small>
                        </div>

                        <div class="col-md-6">
                            <input type="text" class="form-control" id="stateProvince" name="stateProvince" required>
                            <small>State/Province</small>
                            <small class="text-danger" id="stateProvinceError"></small>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="postalCode" name="postalCode" required>
                            <small>Postal / Zip Code</small>
                            <small class="text-danger" id="postalCodeError"></small>
                        </div>

                        <div class="col-md-6">
                            <select name="state" class="form-control" id="countrySelect" required>
                                <option value="" disabled selected>Please Select</option>
                                <option value="India">India</option>
                            </select>
                            <small>Country</small>
                            <small class="text-danger" id="countrySelectError"></small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="my-3 row">
                <div class="col-4">
                    <label for="mailingAddress">4. Mailing address (if different from above)</label>
                </div>

                <div class="col-8">
                    <div>
                        <input type="text" class="form-control" id="mailingAddress" name="mailingAddress">
                        <small>Street Address</small>
                    </div>

                    <div class="mt-3">
                        <input type="text" class="form-control" id="mailingAddress2" name="mailingAddress2">
                        <small>Street Address Line 2</small>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="mailingCity" name="mailingCity">
                            <small>City</small>
                        </div>

                        <div class="col-md-6">
                            <input type="text" class="form-control" id="mailingStateProvince"
                                name="mailingStateProvince">
                            <small>State/Province</small>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="mailingPostalCode" name="mailingPostalCode">
                            <small>Zip/ Postal Code</small>
                        </div>

                        <div class="col-md-6">
                            <select name="mailingState" class="form-control" id="mailingStateSelect">
                                <option value="" disabled selected>Please Select</option>
                                <option value="Gujarat">Gujarat</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="my-3 row">
                <div class="col-4">
                    <label for="foreignTaxId">6. Foreign tax identifying number (see instructions)</label>
                </div>

                <div class="col-8">
                    <input type="text" class="form-control" id="foreignTaxId" name="foreignTaxId">
                    <small class="text-danger" id="foreignTaxIdError"></small>
                </div>
            </div>

            <div class="my-3 row">
                <div class="col-4">
                    <label for="referenceNumber">7. Reference number(s) (see instructions)</label>
                </div>

                <div class="col-8">
                    <input type="text" class="form-control" id="referenceNumber" name="referenceNumber">
                    <small class="text-danger" id="referenceNumberError"></small>
                </div>
            </div>

            <div class="my-3 row">
                <div class="col-4">
                    <label for="dateOfBirth">8. Date of birth (MM-DD-YYYY) (see instructions)</label>
                </div>

                <div class="col-8">
                    <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth" required>
                    <small>Date</small>
                    <small class="text-danger" id="dateOfBirthError"></small>
                </div>
            </div>

            <div class="my-5">
                <h4>Part II: Claim of Tax Treaty Benefits</h4>
                <small>See instructions (for chapter 3 purposes only)</small>
            </div>

            <hr>
            <p>9. I certify that the beneficial owner is a resident of <input type="text"
                    class="form-control d-inline w-50" id="treatyCountry" name="treatyCountry"
                    style="display: inline-block; width: auto;"> within the meaning of the income tax treaty between the
                United States and that country.</p>

            <p>10.Special rates and conditions (if applicable-see instructions): The beneficial owner is claiming the provisions of Article and paragraph <input type="text">
                Type a label
                <input type="text">  of the treaty identified on line 9 above to claim a   ﻿
                Type a label
                ﻿   % rate of withholding on (specify type of income):   ﻿
                Type a label
                ﻿   . Explain the additional conditions in the Article and paragraph the beneficial owner meets to be eligible for the rate of withholding:<input type="text">.</p>

            <div class="my-5">
                <h4>Part III: Certification</h4>
            </div>

            <hr>

            <div class="mt-5">
                <p>Under penalties of perjury, I declare that I have examined the information on this form and to the
                    best of my knowledge and belief it is true, correct, and complete. I further certify under penalties
                    of perjury that:</p>

                <ul>
                    <li>I am the individual that is the beneficial owner (or am authorized to sign for the individual
                        that is the beneficial owner) of all the income to which this form relates or am using this form
                        to document myself for chapter 4 purposes,</li>

                    <li>The person named on line 1 of this form is not a U.S. person,</li>
                    <li>The income to which this form relates is:</li>
                    <li>
                        <ul>
                            <li>(a) not effectively connected with the conduct of a trade or business in the United
                                States,</li>
                            <li>(b) effectively connected but is not subject to tax under an applicable income tax
                                treaty,</li>
                            <li>or (c) the partner’s share of a partnership's effectively connected income,</li>
                        </ul>
                    </li>

                    <li>
                        The person named on line 1 of this form is a resident of the treaty country listed on line 9 of
                        the form (if any) within the meaning of the income tax treaty between the United States and that
                        country, and
                    </li>

                    <li>For broker transactions or barter exchanges, the beneficial owner is an exempt foreign person as
                        defined in the instructions.</li>
                </ul>

                <p>Furthermore, I authorize this form to be provided to any withholding agent that has control, receipt,
                    or custody of the income of which I am the beneficial owner or any withholding agent that can
                    disburse or make payments of the income of which I am the beneficial owner. I agree that I will
                    submit a new form within 30 days if any certification made on this form becomes incorrect.</p>
            </div>
            <div class="my-3 row">
                <div class="col-4">
                    <label for="signature">Signature of beneficial owner (or individual authorized to sign for
                        beneficial owner)</label>
                </div>

                <div class="col-8">
                    <canvas id="signature-pad" class="signature-pad"></canvas>
                </div>
            </div>

            <div class="my-3 row">
                <div class="col-4">
                    <label for="signatureDate">Date (MM-DD-YYYY)</label>
                </div>

                <div class="col-8">
                    <input type="date" class="form-control" id="signatureDate" name="signatureDate" required>
                    <small>Date</small>
                    <small class="text-danger" id="signatureDateError"></small>
                </div>
            </div>

            <div class="my-3 row">
                <div class="col-4">
                    <label for="signerName">Print name of signer</label>
                </div>

                <div class="col-8">
                    <input type="text" class="form-control" id="signerName" name="signerName" required>
                    <small class="text-danger" id="signerNameError"></small>
                </div>
            </div>

            <div class="my-3 row">
                <div class="col-4">
                    <label for="capacity">Capacity in which acting (if form is not signed by beneficial owner)</label>
                </div>

                <div class="col-8">
                    <input type="text" class="form-control" id="capacity" name="capacity">
                </div>
            </div>

            <hr>
            <div class="d-flex justify-content-center gap-2">
                <button type="button" class="btn btn-secondary px-5" id="preview-btn">Preview PDF</button>
                <button type="submit" class="btn btn-success px-5" id="submit-btn">Submit</button>
            </div>
        </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
       document.getElementById('preview-btn').addEventListener('click', (event) => {
    const { jsPDF } = window.jspdf;
    if (!validateForm(event)) {
        return;
    }
    let isValid = true;

    $(".text-danger").text("");
    const beneficialOwnerName = $("#beneficialOwnerName").val();
    const countryOfCitizenship = $("#countryOfCitizenship").val();
    const permanentAddress = $("#permanentAddress").val();
    const city = $("#city").val();
    const stateProvince = $("#stateProvince").val();
    const postalCode = $("#postalCode").val();
    const mailingAddress = $("#mailingAddress").val();
    const mailingCity = $("#mailingCity").val();
    const mailingStateProvince = $("#mailingStateProvince").val();
    const mailingPostalCode = $("#mailingPostalCode").val();
    const dateOfBirth = $("#dateOfBirth").val();
    const treatyCountry = $("#treatyCountry").val();
    const signatureDate = $("#signatureDate").val();
    const signerName = $("#signerName").val();
    const capacity = $("#capacity").val();

    if (!beneficialOwnerName || !countryOfCitizenship || !permanentAddress || !city || !stateProvince || !postalCode || !dateOfBirth || !signatureDate || !signerName) {
        alert("Please complete all required fields before previewing the PDF.");
        return;
    }

    const doc = new jsPDF();
    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);

    // Add Form Data to the PDF
    doc.text(`Beneficial Owner Name: ${beneficialOwnerName}`, 10, 20);
    doc.text(`Country of Citizenship: ${countryOfCitizenship}`, 10, 30);
    doc.text(`Permanent Address: ${permanentAddress}`, 10, 40);
    doc.text(`City: ${city}`, 10, 50);
    doc.text(`State/Province: ${stateProvince}`, 10, 60);
    doc.text(`Postal Code: ${postalCode}`, 10, 70);
    doc.text(`Mailing Address: ${mailingAddress || "N/A"}`, 10, 80);
    doc.text(`Mailing City: ${mailingCity || "N/A"}`, 10, 90);
    doc.text(`Mailing State/Province: ${mailingStateProvince || "N/A"}`, 10, 100);
    doc.text(`Mailing Postal Code: ${mailingPostalCode || "N/A"}`, 10, 110);
    doc.text(`Date of Birth: ${dateOfBirth}`, 10, 120);
    doc.text(`Treaty Country: ${treatyCountry}`, 10, 130);
    doc.text(`Signature Date: ${signatureDate}`, 10, 140);
    doc.text(`Signer Name: ${signerName}`, 10, 150);
    doc.text(`Capacity: ${capacity || "N/A"}`, 10, 160);

    // Add signature (if available)
    if (!signaturePad.isEmpty()) {
        const signatureData = signaturePad.toDataURL();
        doc.addImage(signatureData, "PNG", 10, 170, 50, 30);
    }

    // Preview the PDF (open in a new window/tab)
    doc.autoPrint();
    window.open(doc.output("bloburl"), "_blank");
});

const canvas = document.getElementById("signature-pad");
const signaturePad = new SignaturePad(canvas);

$("#certificateForm").on("submit", validateForm);

function validateForm(event) {
    event.preventDefault();
    let isValid = true;

    $(".text-danger").text("");
    $(".form-control").removeClass("is-valid is-invalid");

    const namePattern = /^[a-zA-Z\s]{2,50}$/; // Only letters, spaces; 2-50 characters
    const countryPattern = /^[a-zA-Z\s]{2,50}$/; // Only letters, spaces; 2-50 characters
    const addressPattern = /^[a-zA-Z0-9\s,.-]{5,100}$/;
    const cityPattern = /^[a-zA-Z\s]{2,50}$/; // Only letters, spaces; 2-50 characters
    const statePattern = /^[a-zA-Z\s]{2,50}$/; // Only letters, spaces; 2-50 characters
    const postalPattern = /^[0-9]{5}(-[0-9]{4})?$/; // US ZIP: 5 digits or 5-4 format
    const datePattern = /^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/; // YYYY-MM-DD with valid month/day

    // Validate Name
    const beneficialOwnerName = $("#beneficialOwnerName").val();
    if (!namePattern.test(beneficialOwnerName)) {
        $("#beneficialOwnerNameError").text("Name must contain only letters and spaces (2-50 characters).");
        $("#beneficialOwnerName").addClass("is-invalid");
        isValid = false;
    } else {
        $("#beneficialOwnerName").addClass("is-valid");
    }

    const countryOfCitizenship = $("#countryOfCitizenship").val();
    if (!countryPattern.test(countryOfCitizenship)) {
        $("#countryOfCitizenshipError").text("Country must contain only letters and spaces (2-50 characters).");
        $("#countryOfCitizenship").addClass("is-invalid");
        isValid = false;
    } else {
        $("#countryOfCitizenship").addClass("is-valid");
    }

    const permanentAddress = $("#permanentAddress").val();
    if (!addressPattern.test(permanentAddress)) {
        $("#permanentAddressError").text(
            "Address must be alphanumeric, including spaces, commas, periods, or hyphens (5-100 characters)."
        );
        $("#permanentAddress").addClass("is-invalid");
        isValid = false;
    } else {
        $("#permanentAddress").addClass("is-valid");
    }

    // Validate City
    const city = $("#city").val();
    if (!cityPattern.test(city)) {
        $("#cityError").text("City must contain only letters and spaces (2-50 characters).");
        $("#city").addClass("is-invalid");
        isValid = false;
    } else {
        $("#city").addClass("is-valid");
    }

    // Validate State/Province
    const stateProvince = $("#stateProvince").val();
    if (!statePattern.test(stateProvince)) {
        $("#stateProvinceError").text("State/Province must contain only letters and spaces (2-50 characters).");
        $("#stateProvince").addClass("is-invalid");
        isValid = false;
    } else {
        $("#stateProvince").addClass("is-valid");
    }

    // Validate Postal Code
    const postalCode = $("#postalCode").val();
    if (!postalPattern.test(postalCode)) {
        $("#postalCodeError").text("Postal code must be in the format '12345' or '12345-6789'.");
        $("#postalCode").addClass("is-invalid");
        isValid = false;
    } else {
        $("#postalCode").addClass("is-valid");
    }

    // Validate Mailing Address
    const mailingAddress = $("#mailingAddress").val();
    if (mailingAddress && !addressPattern.test(mailingAddress)) {
        $("#mailingAddressError").text("Mailing address must be alphanumeric (5-100 characters).");
        $("#mailingAddress").addClass("is-invalid");
        isValid = false;
    } else {
        $("#mailingAddress").addClass("is-valid");
    }

    // Validate Mailing City
    const mailingCity = $("#mailingCity").val();
    if (mailingCity && !cityPattern.test(mailingCity)) {
        $("#mailingCityError").text("Mailing city must contain only letters and spaces (2-50 characters).");
        $("#mailingCity").addClass("is-invalid");
        isValid = false;
    } else {
        $("#mailingCity").addClass("is-valid");
    }

    // Validate Mailing State/Province
    const mailingStateProvince = $("#mailingStateProvince").val();
    if (mailingStateProvince && !statePattern.test(mailingStateProvince)) {
        $("#mailingStateProvinceError").text("Mailing state/province must contain only letters and spaces (2-50 characters).");
        $("#mailingStateProvince").addClass("is-invalid");
        isValid = false;
    } else {
        $("#mailingStateProvince").addClass("is-valid");
    }

    // Validate Mailing Postal Code
    const mailingPostalCode = $("#mailingPostalCode").val();
    if (mailingPostalCode && !postalPattern.test(mailingPostalCode)) {
        $("#mailingPostalCodeError").text("Mailing postal code must be in the format '12345' or '12345-6789'.");
        $("#mailingPostalCode").addClass("is-invalid");
        isValid = false;
    } else {
        $("#mailingPostalCode").addClass("is-valid");
    }

    // Validate Foreign Tax ID
    const foreignTaxId = $("#foreignTaxId").val();
    if (foreignTaxId && !addressPattern.test(foreignTaxId)) {
        $("#foreignTaxIdError").text("Foreign Tax ID must be alphanumeric (5-100 characters).");
        $("#foreignTaxId").addClass("is-invalid");
        isValid = false;
    } else {
        $("#foreignTaxId").addClass("is-valid");
    }

    const referenceNumber = $("#referenceNumber").val();
    if (referenceNumber && !addressPattern.test(referenceNumber)) {
        $("#referenceNumberError").text("Reference Number must be alphanumeric (5-100 characters).");
        $("#referenceNumber").addClass("is-invalid");
        isValid = false;
    } else {
        $("#referenceNumber").addClass("is-valid");
    }

    const dateOfBirth = $("#dateOfBirth").val();
    if (!dateOfBirth) {
        $("#dateOfBirthError").text("Date of birth is required.");
        $("#dateOfBirth").addClass("is-invalid");
        isValid = false;
    } else {
        const today = new Date().toISOString().split("T")[0]; // Get today's date
        if (dateOfBirth >= today) {
            $("#dateOfBirthError").text("Date of birth must be a past date.");
            $("#dateOfBirth").addClass("is-invalid");
            isValid = false;
        } else {
            $("#dateOfBirth").addClass("is-valid");
        }
    }

    const treatyCountry = $("#treatyCountry").val();
    if (!countryPattern.test(treatyCountry)) {
        $("#treatyCountryError").text("Treaty country must contain only letters and spaces (2-50 characters).");
        $("#treatyCountry").addClass("is-invalid");
        isValid = false;
    } else {
        $("#treatyCountry").addClass("is-valid");
    }

    if (signaturePad.isEmpty()) {
        alert("Please provide a valid signature.");
        isValid = false;
    }

    const signatureDate = $("#signatureDate").val();
    if (!signatureDate) {
        $("#signatureDateError").text("Signature date is required.");
        $("#signatureDate").addClass("is-invalid");
        isValid = false;
    } else {
        $("#signatureDate").addClass("is-valid");
    }

    const signerName = $("#signerName").val();
    if (!namePattern.test(signerName)) {
        $("#signerNameError").text("Signer name must contain only letters and spaces (2-50 characters).");
        $("#signerName").addClass("is-invalid");
        isValid = false;
    } else {
        $("#signerName").addClass("is-valid");
    }

    const capacity = $("#capacity").val();
    if (capacity && !addressPattern.test(capacity)) {
        $("#capacityError").text("Capacity must be alphanumeric (5-100 characters).");
        $("#capacity").addClass("is-invalid");
        isValid = false;
    } else {
        $("#capacity").addClass("is-valid");
    }

    if (isValid) {
        const signatureData = signaturePad.toDataURL(); 
        console.log("Signature Data:", signatureData);
        alert("Form submitted successfully!");
    }

    return isValid;
}


    </script>
</body>

</html>